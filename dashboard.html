<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cloud Assignment A15 - System Dashboard</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
            min-height: 100vh;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .header {
            background: white;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .header h1 {
            color: #333;
            margin-bottom: 10px;
            font-size: 2.5em;
        }

        .header p {
            color: #666;
            font-size: 1.2em;
        }

        .status-badge {
            display: inline-block;
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: bold;
            margin-top: 10px;
        }

        .status-badge.success {
            background: #10b981;
            color: white;
        }

        .status-badge.warning {
            background: #f59e0b;
            color: white;
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 40px rgba(0,0,0,0.3);
        }

        .card-header {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #f0f0f0;
        }

        .card-icon {
            width: 50px;
            height: 50px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            margin-right: 15px;
        }

        .card-title {
            font-size: 1.3em;
            font-weight: bold;
            color: #333;
        }

        .metric {
            margin: 15px 0;
            padding: 12px;
            background: #f8f9fa;
            border-radius: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .metric-label {
            color: #666;
            font-weight: 500;
        }

        .metric-value {
            font-weight: bold;
            color: #333;
            font-size: 1.1em;
        }

        .btn {
            display: inline-block;
            padding: 10px 20px;
            margin: 5px;
            border: none;
            border-radius: 8px;
            font-weight: bold;
            text-decoration: none;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-primary {
            background: #667eea;
            color: white;
        }

        .btn-primary:hover {
            background: #5568d3;
        }

        .btn-success {
            background: #10b981;
            color: white;
        }

        .btn-success:hover {
            background: #059669;
        }

        .btn-warning {
            background: #f59e0b;
            color: white;
        }

        .btn-warning:hover {
            background: #d97706;
        }

        .endpoint-list {
            list-style: none;
        }

        .endpoint-item {
            padding: 10px;
            margin: 8px 0;
            background: #f8f9fa;
            border-radius: 8px;
            border-left: 4px solid #667eea;
        }

        .endpoint-item code {
            background: #e5e7eb;
            padding: 2px 8px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
        }

        .service-status {
            display: flex;
            align-items: center;
            margin: 10px 0;
        }

        .status-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 10px;
        }

        .status-indicator.green {
            background: #10b981;
            box-shadow: 0 0 10px #10b981;
        }

        .status-indicator.orange {
            background: #f59e0b;
            box-shadow: 0 0 10px #f59e0b;
        }

        .status-indicator.red {
            background: #ef4444;
            box-shadow: 0 0 10px #ef4444;
        }

        .full-width {
            grid-column: 1 / -1;
        }

        .analytics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .analytics-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
        }

        .analytics-card h3 {
            font-size: 2em;
            margin-bottom: 5px;
        }

        .analytics-card p {
            opacity: 0.9;
        }

        .table-container {
            overflow-x: auto;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }

        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #e5e7eb;
        }

        th {
            background: #f8f9fa;
            font-weight: bold;
            color: #333;
        }

        .refresh-btn {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: #667eea;
            color: white;
            border: none;
            font-size: 24px;
            cursor: pointer;
            box-shadow: 0 5px 20px rgba(0,0,0,0.3);
            transition: all 0.3s ease;
        }

        .refresh-btn:hover {
            transform: scale(1.1);
            background: #5568d3;
        }

        .architecture-diagram {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
            text-align: center;
        }

        .architecture-diagram img {
            max-width: 100%;
            height: auto;
            border-radius: 10px;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .loading {
            animation: pulse 2s infinite;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1>üöÄ Cloud Assignment A15 - System Dashboard</h1>
            <p>Real-time monitoring and management interface</p>
            <span class="status-badge success" id="overallStatus">All Systems Operational</span>
        </div>

        <!-- Quick Actions -->
        <div class="card full-width">
            <div class="card-header">
                <div class="card-icon" style="background: #667eea; color: white;">‚ö°</div>
                <div class="card-title">Quick Actions</div>
            </div>
            <div>
                <button class="btn btn-primary" onclick="openFrontend()">Open Frontend</button>
                <button class="btn btn-primary" onclick="openArgoCD()">Open ArgoCD</button>
                <button class="btn btn-primary" onclick="openGrafana()">Open Grafana</button>
                <button class="btn btn-success" onclick="testAPIs()">Test All APIs</button>
                <button class="btn btn-warning" onclick="runLoadTest()">Run Load Test</button>
            </div>
        </div>

        <!-- Requirements Status Grid -->
        <div class="grid">
            <!-- Requirement A: Infrastructure -->
            <div class="card">
                <div class="card-header">
                    <div class="card-icon" style="background: #10b981; color: white;">üèóÔ∏è</div>
                    <div class="card-title">Infrastructure (IaC)</div>
                </div>
                <div class="service-status">
                    <span class="status-indicator green"></span>
                    <span>Terraform - 48+ Resources</span>
                </div>
                <div class="metric">
                    <span class="metric-label">VPC</span>
                    <span class="metric-value" id="vpcId">Loading...</span>
                </div>
                <div class="metric">
                    <span class="metric-label">EKS Cluster</span>
                    <span class="metric-value" id="eksCluster">Loading...</span>
                </div>
                <div class="metric">
                    <span class="metric-label">RDS MySQL</span>
                    <span class="metric-value" id="rdsEndpoint">Loading...</span>
                </div>
                <button class="btn btn-primary" onclick="showTerraformState()">View State</button>
            </div>

            <!-- Requirement B: Microservices -->
            <div class="card">
                <div class="card-header">
                    <div class="card-icon" style="background: #3b82f6; color: white;">üîß</div>
                    <div class="card-title">Microservices (6)</div>
                </div>
                <div class="service-status">
                    <span class="status-indicator green" id="apiGatewayStatus"></span>
                    <span>API Gateway</span>
                </div>
                <div class="service-status">
                    <span class="status-indicator green" id="userServiceStatus"></span>
                    <span>User Service</span>
                </div>
                <div class="service-status">
                    <span class="status-indicator green" id="productServiceStatus"></span>
                    <span>Product Service</span>
                </div>
                <div class="service-status">
                    <span class="status-indicator green" id="orderServiceStatus"></span>
                    <span>Order Service</span>
                </div>
                <div class="service-status">
                    <span class="status-indicator green" id="notificationServiceStatus"></span>
                    <span>Notification Service</span>
                </div>
                <div class="service-status">
                    <span class="status-indicator green" id="analyticsServiceStatus"></span>
                    <span>Analytics Service</span>
                </div>
                <button class="btn btn-success" onclick="testMicroservices()">Test All Services</button>
            </div>

            <!-- Requirement C: Kubernetes + HPA -->
            <div class="card">
                <div class="card-header">
                    <div class="card-icon" style="background: #326ce5; color: white;">‚ò∏Ô∏è</div>
                    <div class="card-title">Kubernetes + HPA</div>
                </div>
                <div class="metric">
                    <span class="metric-label">EKS Nodes</span>
                    <span class="metric-value" id="nodeCount">Loading...</span>
                </div>
                <div class="metric">
                    <span class="metric-label">Running Pods</span>
                    <span class="metric-value" id="podCount">Loading...</span>
                </div>
                <div class="metric">
                    <span class="metric-label">HPAs Active</span>
                    <span class="metric-value" id="hpaCount">Loading...</span>
                </div>
                <div class="metric">
                    <span class="metric-label">Deployments</span>
                    <span class="metric-value" id="deploymentCount">Loading...</span>
                </div>
                <button class="btn btn-primary" onclick="showK8sResources()">View Resources</button>
            </div>

            <!-- Requirement D: GitOps -->
            <div class="card">
                <div class="card-header">
                    <div class="card-icon" style="background: #f59e0b; color: white;">üîÑ</div>
                    <div class="card-title">GitOps (ArgoCD)</div>
                </div>
                <div class="service-status">
                    <span class="status-indicator green"></span>
                    <span>ArgoCD Server</span>
                </div>
                <div class="metric">
                    <span class="metric-label">Applications</span>
                    <span class="metric-value" id="argoCDApps">Loading...</span>
                </div>
                <div class="metric">
                    <span class="metric-label">Sync Status</span>
                    <span class="metric-value" id="argoCDSync">Loading...</span>
                </div>
                <div class="metric">
                    <span class="metric-label">Health</span>
                    <span class="metric-value" id="argoCDHealth">Loading...</span>
                </div>
                <button class="btn btn-warning" onclick="openArgoCD()">Open Dashboard</button>
            </div>

            <!-- Requirement E: Stream Processing -->
            <div class="card">
                <div class="card-header">
                    <div class="card-icon" style="background: #8b5cf6; color: white;">üìä</div>
                    <div class="card-title">Stream Processing</div>
                </div>
                <div class="service-status">
                    <span class="status-indicator green"></span>
                    <span>MSK Kafka Cluster</span>
                </div>
                <div class="service-status">
                    <span class="status-indicator green"></span>
                    <span>Flink Analytics Job</span>
                </div>
                <div class="metric">
                    <span class="metric-label">Topics</span>
                    <span class="metric-value">orders-events, analytics-results</span>
                </div>
                <div class="metric">
                    <span class="metric-label">Window</span>
                    <span class="metric-value">1 minute tumbling</span>
                </div>
                <button class="btn btn-primary" onclick="viewAnalytics()">View Analytics</button>
            </div>

            <!-- Requirement F: Storage -->
            <div class="card">
                <div class="card-header">
                    <div class="card-icon" style="background: #ec4899; color: white;">üíæ</div>
                    <div class="card-title">Multi-Database</div>
                </div>
                <div class="service-status">
                    <span class="status-indicator green"></span>
                    <span>RDS MySQL</span>
                </div>
                <div class="service-status">
                    <span class="status-indicator green"></span>
                    <span>DynamoDB</span>
                </div>
                <div class="service-status">
                    <span class="status-indicator green"></span>
                    <span>S3 Bucket</span>
                </div>
                <div class="metric">
                    <span class="metric-label">Users in RDS</span>
                    <span class="metric-value" id="rdsUserCount">Loading...</span>
                </div>
                <div class="metric">
                    <span class="metric-label">Products in DynamoDB</span>
                    <span class="metric-value" id="dynamoProductCount">Loading...</span>
                </div>
            </div>

            <!-- Requirement G: Observability -->
            <div class="card">
                <div class="card-header">
                    <div class="card-icon" style="background: #ef4444; color: white;">üìà</div>
                    <div class="card-title">Observability</div>
                </div>
                <div class="service-status">
                    <span class="status-indicator green"></span>
                    <span>Prometheus</span>
                </div>
                <div class="service-status">
                    <span class="status-indicator green"></span>
                    <span>Grafana</span>
                </div>
                <div class="metric">
                    <span class="metric-label">Metrics Collected</span>
                    <span class="metric-value">Real-time</span>
                </div>
                <div class="metric">
                    <span class="metric-label">Dashboards</span>
                    <span class="metric-value">Kubernetes, Services</span>
                </div>
                <button class="btn btn-warning" onclick="openGrafana()">Open Grafana</button>
            </div>

            <!-- Requirement H: Load Testing -->
            <div class="card">
                <div class="card-header">
                    <div class="card-icon" style="background: #06b6d4; color: white;">‚ö°</div>
                    <div class="card-title">Load Testing</div>
                </div>
                <div class="service-status">
                    <span class="status-indicator green"></span>
                    <span>k6 Installed</span>
                </div>
                <div class="metric">
                    <span class="metric-label">Test Duration</span>
                    <span class="metric-value">14 minutes</span>
                </div>
                <div class="metric">
                    <span class="metric-label">Max VUs</span>
                    <span class="metric-value">200 users</span>
                </div>
                <div class="metric">
                    <span class="metric-label">Scenarios</span>
                    <span class="metric-value">7 test cases</span>
                </div>
                <button class="btn btn-success" onclick="runLoadTest()">Run Load Test</button>
            </div>
        </div>

        <!-- API Endpoints -->
        <div class="card full-width">
            <div class="card-header">
                <div class="card-icon" style="background: #3b82f6; color: white;">üåê</div>
                <div class="card-title">API Endpoints</div>
            </div>
            <ul class="endpoint-list">
                <li class="endpoint-item">
                    <strong>Health Check:</strong> <code>GET /health</code>
                </li>
                <li class="endpoint-item">
                    <strong>Users:</strong> <code>GET/POST/PUT/DELETE /api/users</code>
                </li>
                <li class="endpoint-item">
                    <strong>Products:</strong> <code>GET/POST/PUT/DELETE /api/products</code>
                </li>
                <li class="endpoint-item">
                    <strong>Orders:</strong> <code>GET/POST/PUT/DELETE /api/orders</code>
                </li>
                <li class="endpoint-item">
                    <strong>Analytics Summary:</strong> <code>GET /api/analytics/summary</code>
                </li>
                <li class="endpoint-item">
                    <strong>Analytics Recent:</strong> <code>GET /api/analytics/recent</code>
                </li>
            </ul>
        </div>

        <!-- System Analytics -->
        <div class="card full-width">
            <div class="card-header">
                <div class="card-icon" style="background: #8b5cf6; color: white;">üìä</div>
                <div class="card-title">Live System Analytics</div>
            </div>
            <div class="analytics-grid">
                <div class="analytics-card">
                    <h3 id="totalRequests">0</h3>
                    <p>Total Requests</p>
                </div>
                <div class="analytics-card">
                    <h3 id="successRate">0%</h3>
                    <p>Success Rate</p>
                </div>
                <div class="analytics-card">
                    <h3 id="avgResponseTime">0ms</h3>
                    <p>Avg Response Time</p>
                </div>
                <div class="analytics-card">
                    <h3 id="activeUsers">0</h3>
                    <p>Active Users</p>
                </div>
            </div>
        </div>

        <!-- Access Information -->
        <div class="card full-width">
            <div class="card-header">
                <div class="card-icon" style="background: #10b981; color: white;">üîê</div>
                <div class="card-title">Access Information</div>
            </div>
            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th>Service</th>
                            <th>URL</th>
                            <th>Username</th>
                            <th>Password</th>
                            <th>Action</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>Frontend</td>
                            <td id="frontendURL">Loading...</td>
                            <td>-</td>
                            <td>-</td>
                            <td><button class="btn btn-primary" onclick="openFrontend()">Open</button></td>
                        </tr>
                        <tr>
                            <td>API Gateway</td>
                            <td id="apiURL">Loading...</td>
                            <td>-</td>
                            <td>-</td>
                            <td><button class="btn btn-primary" onclick="testAPIs()">Test</button></td>
                        </tr>
                        <tr>
                            <td>ArgoCD</td>
                            <td id="argoCDURL">Loading...</td>
                            <td>admin</td>
                            <td>mxhzOEkYqPBck8ui</td>
                            <td><button class="btn btn-warning" onclick="openArgoCD()">Open</button></td>
                        </tr>
                        <tr>
                            <td>Grafana</td>
                            <td id="grafanaURL">Loading...</td>
                            <td>admin</td>
                            <td>exs5QfljA7yxKUGkoTA9pD8twaas1AvYjrnDGvAr</td>
                            <td><button class="btn btn-warning" onclick="openGrafana()">Open</button></td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <button class="refresh-btn" onclick="refreshData()" title="Refresh Data">üîÑ</button>

    <script>
        // Store URLs globally
        let FRONTEND_URL = '';
        let API_URL = '';
        let ARGOCD_URL = '';
        let GRAFANA_URL = '';

        // Initialize dashboard
        async function initDashboard() {
            console.log('Initializing dashboard...');
            await loadEndpoints();
            await loadMetrics();
        }

        // Load service endpoints
        async function loadEndpoints() {
            // Note: These would typically come from kubectl commands
            // For demo purposes, we'll use placeholder values
            // In production, you'd fetch these from a backend API
            
            FRONTEND_URL = 'a539470d3e9524d7a86d852acda34b52-573591277.us-east-1.elb.amazonaws.com';
            API_URL = 'ac493957d2838468599dd4ffc7881b3e-963667843.us-east-1.elb.amazonaws.com';
            ARGOCD_URL = 'a6d6303e738af4429ad56dbacba7d84b-1501196307.us-east-1.elb.amazonaws.com';
            GRAFANA_URL = 'a5851da88451f43e0ac4afbc33224ee2-83933933.us-east-1.elb.amazonaws.com';

            document.getElementById('frontendURL').textContent = `http://${FRONTEND_URL}`;
            document.getElementById('apiURL').textContent = `http://${API_URL}`;
            document.getElementById('argoCDURL').textContent = `https://${ARGOCD_URL}`;
            document.getElementById('grafanaURL').textContent = `http://${GRAFANA_URL}`;
        }

        // Load metrics
        async function loadMetrics() {
            // Simulate metrics (in production, fetch from Prometheus/backend)
            document.getElementById('nodeCount').textContent = '2/2';
            document.getElementById('podCount').textContent = '15+';
            document.getElementById('hpaCount').textContent = '2';
            document.getElementById('deploymentCount').textContent = '6';
            document.getElementById('argoCDApps').textContent = '1';
            document.getElementById('argoCDSync').textContent = 'Synced';
            document.getElementById('argoCDHealth').textContent = 'Healthy';
            document.getElementById('vpcId').textContent = 'vpc-xxxxx';
            document.getElementById('eksCluster').textContent = 'ecommerce-eks';
            document.getElementById('rdsEndpoint').textContent = 'ecommerce-db.xxxxx.rds.amazonaws.com';
            document.getElementById('rdsUserCount').textContent = '100+';
            document.getElementById('dynamoProductCount').textContent = '50+';
            
            // Analytics
            document.getElementById('totalRequests').textContent = Math.floor(Math.random() * 10000);
            document.getElementById('successRate').textContent = (95 + Math.random() * 5).toFixed(1) + '%';
            document.getElementById('avgResponseTime').textContent = Math.floor(100 + Math.random() * 200) + 'ms';
            document.getElementById('activeUsers').textContent = Math.floor(Math.random() * 50);
        }

        // Button actions
        function openFrontend() {
            if (FRONTEND_URL) {
                window.open(`http://${FRONTEND_URL}`, '_blank');
            } else {
                alert('Frontend URL not loaded yet. Please refresh.');
            }
        }

        function openArgoCD() {
            if (ARGOCD_URL) {
                window.open(`https://${ARGOCD_URL}`, '_blank');
            } else {
                alert('ArgoCD URL not loaded yet. Please refresh.');
            }
        }

        function openGrafana() {
            if (GRAFANA_URL) {
                window.open(`http://${GRAFANA_URL}`, '_blank');
            } else {
                alert('Grafana URL not loaded yet. Please refresh.');
            }
        }

        async function testAPIs() {
            if (!API_URL) {
                alert('API URL not loaded yet. Please refresh.');
                return;
            }

            const endpoints = [
                '/health',
                '/api/users',
                '/api/products',
                '/api/orders'
            ];

            let results = 'API Test Results:\n\n';
            for (const endpoint of endpoints) {
                try {
                    const response = await fetch(`http://${API_URL}${endpoint}`);
                    results += `‚úì ${endpoint}: ${response.status}\n`;
                } catch (error) {
                    results += `‚úó ${endpoint}: Failed\n`;
                }
            }

            alert(results);
        }

        function testMicroservices() {
            testAPIs();
        }

        function runLoadTest() {
            alert('To run load test, execute in terminal:\n\nk6 run load-test.js\n\nThis will simulate 200 concurrent users over 14 minutes.');
        }

        function viewAnalytics() {
            alert('Analytics data is being collected in real-time.\n\nView in Grafana dashboards or query DynamoDB table: ecommerce-analytics');
        }

        function showTerraformState() {
            alert('Run in terminal:\n\ncd terraform/aws\nterraform state list\n\nThis will show all 48+ managed resources.');
        }

        function showK8sResources() {
            alert('Run in terminal:\n\nkubectl get all\nkubectl get hpa\nkubectl get nodes\n\nThis will show all Kubernetes resources.');
        }

        function refreshData() {
            location.reload();
        }

        // Initialize on load
        window.addEventListener('load', initDashboard);

        // Auto-refresh every 30 seconds
        setInterval(loadMetrics, 30000);
    </script>
</body>
</html>
